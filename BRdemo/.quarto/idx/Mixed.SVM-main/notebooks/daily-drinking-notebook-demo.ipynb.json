{"title":"A Bayesian mixed effects Support Vector Machine for learning and predicting daily substance use disorder patterns","markdown":{"yaml":{"title":"A Bayesian mixed effects Support Vector Machine for learning and predicting daily substance use disorder patterns"},"headingText":"Dataset","containsRefs":false,"markdown":"\n\n\n\n\nThis notebook takes daily substance use logs and learns patterns of alcohol use. Features include:\n* Standard summaries and graphics of drinking data (e.g., 7-day, 30-day frequencies)\n* Handles both fixed and random effects in a flexible Bayesian mixed effects SVM (we call it Mixed.SVM)\n* Provides classification for the variable of interest (heavy drinking in this example).  \n* Provides effect estimates and 95% credible intervals (unlike standard SVMs).\n* Inference can be drawn using the credible intervals (is the variable associated with heavy drinking days?).\n* Estimates individual-level risk patterns.\n\n<span style=\"color:red\">IMPORTANT: THIS NOTEBOOK APPLIES THE TOOLKIT TO SIMULATED DATA!\n</span> \n\nTo illustrate the use of the Bayesian mixed effects SVM we simulated data for a cohort of heavy drinkers. You may run the entire notebook on this simulated data\n\nFirst we read in the simulated daily log data. This tracks if the individual used alcohol, nicotine, cannabis, or other drugs.\n\n\n***\n\n\n\nAbove we loaded the daily drinking and drug use data:\n\n\n| Variable | Description | Coding |\n| :--------| :--------- |   ------|\n| ursi | Individual ID |        |\n| male | Male | 1=male;2=female | \n| age | Age in years | \n| Day | Day | |\n| SD | Standard drinks consumed | \n| AD | Did drinking take place? | 1=yes;0=no |\n| HD | Did heavy drinking take place? | 1=yes;0=no |\n| MD | Did moderate drinking take place? | 1=yes;0=no |\n| NICUSEDAY | Any nicotine use (cigarettes, e-cigs, smokekess, etc) | 1=yes;0=no |\n| THCUSEDAY | Any use of THC | 1=yes;0=no |\n| OTHERDRUGUSE | Any use of any other drugs | 1=yes;0=no |\n\n\n\nWe want to learn the alcohol drinking patterns in this data. In other words, we want to fit a model of heavy drinking (`HD`) considering demographics (`age`, `male`) and additional variables that may change over time and influence risk of heavy drinking, including other substances (nicotine, cannabis, and other drugs; `NICUSEDAY`, `THCUSEDAY`, and `OTHERDRUGUSE`, respectively). \n\n\n***\n\n\n## Model\n\nThe Mixed.SVM is described in detail in the manuscript. \n\nThe analysis requires several R libraries. We'll go ahead and install and load these now.\n\nNext we source the algorithm code as well as tools to help summarize the results.\n\nThe arguments of Mixed.SVM are the following\n\n| Argument | Description | Setting |\n| -------- | ----------- | --------- | \n| Y | Response vector encoded 0 and 1 | `HD` |\n| X | Design matrix corresponding to Y | `male`, `age`, `NICUSEDAY`, `THCUSEDAY`, `OTHERDRUGUSE` |\n| T | Vector of times at which the observations in Y were taken | `Day` |\n| U | Vector which indentifies the user IDs for the observations in `Y`, `X`, and `T` | `ursi` |\n| Tmax | Maximum time to be included in the analysis | 720 |\n| knot.seq | Interior knot set for subject specific trajectories | 0.5 | \n| Iter | Number of MCMC iterations | 100000 |\n| burn.in | Number of MCMC iterations to discard | 50000\n\nWe set these parameters for modeling:\n\nNext we call the Mixed.SVM algorithm. \n\n***\n\n## Results\n\n\n### Daily drinking summaries\n\nFirst we summarize daily drinking for the simulated input dataset:\n\n| Variable | Description |\n| -------- | ----------- |\n| pdd | proportion drinking days |\n| phdd | proportion heavy drinking days |\n| ddd | average standard drinks per drinking day |\n| dpd | average standard drinks per day |\n| totaldays | total days |\n| totaldrinkdays | total number of drinking days |\n| totalheavydays | total number of heavy drinking days | \n| phwd | proportion heavy drinking days while drinking | \n| mxd | maximum standard drinks|\n\nAt the baseline assessment in this study, the participants are interviewed and a detailed log of daily drinking is created for the previous 3 months (90 days). So we start summarizing drinking on day 90. Day 181 corresponds to three month after baseline, day 364 for the nine month visit, and day 637 for the eighteen month visit. For these four visits, we'll summarize these variables for the previous month (30 days).\n\nThese are easily adjustable for your study, see `time` and `visitdays` below. The `log.summaries` function generates individual level summaries for the the variables described above. `includevisitday` indicates if the visit day should be included in the summary or not.\n\nWe summarize drinking over the participants in the study by computing the mean, standard deviation, median, minimum, maximum, and number of missing observations for one month of drinking logs at baseline, 3 month, 9 months, and 18 months.\n\nLet's take a look at the individual trends in heavy drinking over the duration of the simulated study. \n\nThe individuals in this study on average drank heavily 25-30% of the past 30 days before each assessment. However, each individual has their own drinking pattern that typical summaries would not capture. \n\n### Mixed-SVM results\nThe `Mixed.SVM` algorithm can take some time to run 100K iterations. We have loaded the results of a previous run so we can look at the results.\n\n#### Classification Rate\n\nFor the simulated data, the model classifies 90% of heavy drinking days correctly. \n\n##### Performance Metrics\n\nHere we compute a summary of the performance of the Mixed-SVM algorithm in predicting heavy drinking days. This includes the rate of true positives (TP or sensitivity), false positives (FP), true negatives (TN or specificity), and false negatives (FN).\n\nIn this simulated data, the model predicts 70% of the days with heavy drinking and 97% of days without heavy drinking correctly. The false positive rate is 3% and the false negative rate is 30%.\n\n#### Parameter Summary\n\nOverall among heavy drinkers in this simulation, we find that age (younger), gender (female), and using nicotine and other drugs are associated with increase risk of heavy drinking episodes. A variable is statistically significant when the 95% credible intervals do not contain zero. \n\n#### Report of subject specific heavy drinking risk\n\nNext we look at the estimated risk trajectories for each study participant. Since there are many trajectories and the user may want to quickly examine the entire cohort, we include some code to layout the graphs 6 per page. For space, we only display the graphs for the first 18 participants.\n\nEach graph is labeled with the de-identified participant id. The risk of heavy drinking is charted by days that individual is followed in the study up to `Tmax`. Values above zero indicate increased risk of heavy drinking and values below zero indicate decreased risk of heavy drinking. The influence of using or discontinuing use of other substances (e.g, tobacco) can be seen by jumps in risk.\n\n#### Analysis of specific subject drinking trajectories\n\nThe user may look closely at an individual's estimated risk of heavy drinking trajectory over time. The function `Ind.trajectory.pretty` takes in the subject indentifier and the results of `SVM.Mixed` and presents the estimated heavy drinking trajectories for two individuals in the simulated data (subject `18` and `24`). Each point is the value of the linear predictor for that given day. The further the values are away from zero, the more or less likely at individualis going to have a heavy drinking day. These values are color coded by the 8 combinations of the 3 time varying covariates (nicotine, cannabis (THC), and other drug use).\n\n#### Significance of the individual specific random trajectories\nWe now look at the individual random trajectories and corresponding 95% credible bands for subject `18`. If the bands exclude zero, the random effects are significant for that individual.\n","srcMarkdownNoYaml":"\n\n\n\n\nThis notebook takes daily substance use logs and learns patterns of alcohol use. Features include:\n* Standard summaries and graphics of drinking data (e.g., 7-day, 30-day frequencies)\n* Handles both fixed and random effects in a flexible Bayesian mixed effects SVM (we call it Mixed.SVM)\n* Provides classification for the variable of interest (heavy drinking in this example).  \n* Provides effect estimates and 95% credible intervals (unlike standard SVMs).\n* Inference can be drawn using the credible intervals (is the variable associated with heavy drinking days?).\n* Estimates individual-level risk patterns.\n\n## Dataset\n<span style=\"color:red\">IMPORTANT: THIS NOTEBOOK APPLIES THE TOOLKIT TO SIMULATED DATA!\n</span> \n\nTo illustrate the use of the Bayesian mixed effects SVM we simulated data for a cohort of heavy drinkers. You may run the entire notebook on this simulated data\n\nFirst we read in the simulated daily log data. This tracks if the individual used alcohol, nicotine, cannabis, or other drugs.\n\n\n***\n\n\n\nAbove we loaded the daily drinking and drug use data:\n\n\n| Variable | Description | Coding |\n| :--------| :--------- |   ------|\n| ursi | Individual ID |        |\n| male | Male | 1=male;2=female | \n| age | Age in years | \n| Day | Day | |\n| SD | Standard drinks consumed | \n| AD | Did drinking take place? | 1=yes;0=no |\n| HD | Did heavy drinking take place? | 1=yes;0=no |\n| MD | Did moderate drinking take place? | 1=yes;0=no |\n| NICUSEDAY | Any nicotine use (cigarettes, e-cigs, smokekess, etc) | 1=yes;0=no |\n| THCUSEDAY | Any use of THC | 1=yes;0=no |\n| OTHERDRUGUSE | Any use of any other drugs | 1=yes;0=no |\n\n\n\nWe want to learn the alcohol drinking patterns in this data. In other words, we want to fit a model of heavy drinking (`HD`) considering demographics (`age`, `male`) and additional variables that may change over time and influence risk of heavy drinking, including other substances (nicotine, cannabis, and other drugs; `NICUSEDAY`, `THCUSEDAY`, and `OTHERDRUGUSE`, respectively). \n\n\n***\n\n\n## Model\n\nThe Mixed.SVM is described in detail in the manuscript. \n\nThe analysis requires several R libraries. We'll go ahead and install and load these now.\n\nNext we source the algorithm code as well as tools to help summarize the results.\n\nThe arguments of Mixed.SVM are the following\n\n| Argument | Description | Setting |\n| -------- | ----------- | --------- | \n| Y | Response vector encoded 0 and 1 | `HD` |\n| X | Design matrix corresponding to Y | `male`, `age`, `NICUSEDAY`, `THCUSEDAY`, `OTHERDRUGUSE` |\n| T | Vector of times at which the observations in Y were taken | `Day` |\n| U | Vector which indentifies the user IDs for the observations in `Y`, `X`, and `T` | `ursi` |\n| Tmax | Maximum time to be included in the analysis | 720 |\n| knot.seq | Interior knot set for subject specific trajectories | 0.5 | \n| Iter | Number of MCMC iterations | 100000 |\n| burn.in | Number of MCMC iterations to discard | 50000\n\nWe set these parameters for modeling:\n\nNext we call the Mixed.SVM algorithm. \n\n***\n\n## Results\n\n\n### Daily drinking summaries\n\nFirst we summarize daily drinking for the simulated input dataset:\n\n| Variable | Description |\n| -------- | ----------- |\n| pdd | proportion drinking days |\n| phdd | proportion heavy drinking days |\n| ddd | average standard drinks per drinking day |\n| dpd | average standard drinks per day |\n| totaldays | total days |\n| totaldrinkdays | total number of drinking days |\n| totalheavydays | total number of heavy drinking days | \n| phwd | proportion heavy drinking days while drinking | \n| mxd | maximum standard drinks|\n\nAt the baseline assessment in this study, the participants are interviewed and a detailed log of daily drinking is created for the previous 3 months (90 days). So we start summarizing drinking on day 90. Day 181 corresponds to three month after baseline, day 364 for the nine month visit, and day 637 for the eighteen month visit. For these four visits, we'll summarize these variables for the previous month (30 days).\n\nThese are easily adjustable for your study, see `time` and `visitdays` below. The `log.summaries` function generates individual level summaries for the the variables described above. `includevisitday` indicates if the visit day should be included in the summary or not.\n\nWe summarize drinking over the participants in the study by computing the mean, standard deviation, median, minimum, maximum, and number of missing observations for one month of drinking logs at baseline, 3 month, 9 months, and 18 months.\n\nLet's take a look at the individual trends in heavy drinking over the duration of the simulated study. \n\nThe individuals in this study on average drank heavily 25-30% of the past 30 days before each assessment. However, each individual has their own drinking pattern that typical summaries would not capture. \n\n### Mixed-SVM results\nThe `Mixed.SVM` algorithm can take some time to run 100K iterations. We have loaded the results of a previous run so we can look at the results.\n\n#### Classification Rate\n\nFor the simulated data, the model classifies 90% of heavy drinking days correctly. \n\n##### Performance Metrics\n\nHere we compute a summary of the performance of the Mixed-SVM algorithm in predicting heavy drinking days. This includes the rate of true positives (TP or sensitivity), false positives (FP), true negatives (TN or specificity), and false negatives (FN).\n\nIn this simulated data, the model predicts 70% of the days with heavy drinking and 97% of days without heavy drinking correctly. The false positive rate is 3% and the false negative rate is 30%.\n\n#### Parameter Summary\n\nOverall among heavy drinkers in this simulation, we find that age (younger), gender (female), and using nicotine and other drugs are associated with increase risk of heavy drinking episodes. A variable is statistically significant when the 95% credible intervals do not contain zero. \n\n#### Report of subject specific heavy drinking risk\n\nNext we look at the estimated risk trajectories for each study participant. Since there are many trajectories and the user may want to quickly examine the entire cohort, we include some code to layout the graphs 6 per page. For space, we only display the graphs for the first 18 participants.\n\nEach graph is labeled with the de-identified participant id. The risk of heavy drinking is charted by days that individual is followed in the study up to `Tmax`. Values above zero indicate increased risk of heavy drinking and values below zero indicate decreased risk of heavy drinking. The influence of using or discontinuing use of other substances (e.g, tobacco) can be seen by jumps in risk.\n\n#### Analysis of specific subject drinking trajectories\n\nThe user may look closely at an individual's estimated risk of heavy drinking trajectory over time. The function `Ind.trajectory.pretty` takes in the subject indentifier and the results of `SVM.Mixed` and presents the estimated heavy drinking trajectories for two individuals in the simulated data (subject `18` and `24`). Each point is the value of the linear predictor for that given day. The further the values are away from zero, the more or less likely at individualis going to have a heavy drinking day. These values are color coded by the 8 combinations of the 3 time varying covariates (nicotine, cannabis (THC), and other drug use).\n\n#### Significance of the individual specific random trajectories\nWe now look at the individual random trajectories and corresponding 95% credible bands for subject `18`. If the bands exclude zero, the random effects are significant for that individual.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"daily-drinking-notebook-demo.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"cosmo","grid":{"sidebar-width":"350px"},"title":"A Bayesian mixed effects Support Vector Machine for learning and predicting daily substance use disorder patterns"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}